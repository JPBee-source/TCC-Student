<!DOCTYPE html>  
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Portal - Sign In</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --overlay-left: rgba(24, 24, 24, 0.93);
}

/* RESET & BASE */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
}

html, body {
    width: 100%;
    height: 100%;
}

/* MAIN CONTAINER */
.container {
    display: flex;
    width: 100%;
    height: 100vh;
}

/* ================= LEFT SIDE ================= */
.left-side {
    flex: 1;
    position: relative;
    background: url('images/right.png') center/cover no-repeat;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1;
}

.left-side::before {
    content: "";
    position: absolute;
    inset: 0;
    background: var(--overlay-left);
    z-index: 1;
}

/* SCHOOL HEADER */
.school-header {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    color: #ffffffb5;
    max-width: 480px;
    transform: translate(-40px, -40px);
}

.school-header img {
    width: 300px;
    height: auto;
    margin-bottom: 1.2rem;
}

.school-header h1 {
    font-size: 30px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 12px;
    line-height: 1.2;
}

.school-header p {
    font-size: 15px;
    line-height: 1.8;
    opacity: 0.95;
}

/* ================= RIGHT SIDE ================= */
.right-side {
    flex: 1;
    background: #f4fef2;
    position: relative;
    display: flex;
    justify-content: center; /* horizontal center */
    align-items: center;     /* vertical center */
    padding: 4rem 2rem;
    clip-path: polygon(10% 0, 100% 0, 100% 100%, 0 100%);
    margin-left: -90px;
    z-index: 2;
}

.right-side::before {
    content: "";
    position: absolute;
    inset: 0;
    clip-path: polygon(10% 0, 100% 0, 100% 100%, 0 100%);
    z-index: -1;
}

/* ================= FORM CONTAINER ================= */
.form-container {
    width: 100%;
    max-width: 420px;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    padding: 3.2rem 1rem;
    color: #000;
    display: flex;
    flex-direction: column;
    max-height: 70vh;
    margin-left: 0;
}

/* Website Logo + Name */
.site-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 40px;
}

.site-logo img {
    width: 25px;
    height: 25px;
}

.site-logo span {
    font-size: 20px;
    font-weight: 700;
    color: #2e7d32;
}

/* FORM HEADER */
.form-container h2 {
    text-align: center;
    margin-bottom: 0.5rem;
    color: #000;
}

/* Sign-in description */
.sign-in-desc {
    text-align: center;
    font-size: 14px;
    color: #333;
    margin-bottom: 20px;
    line-height: 1.5;
}
/* ================= FLOATING LABEL INPUT ================= */ 
.input-container {
    position: relative;
    margin-bottom: 20px;
}

/* INPUT FIELD */
.input-container input {
    width: 100%;
    padding: 16px 18px;
    border-radius: 50px;
    border: 1px solid rgba(0,0,0,0.2);
    background: rgba(255,255,255,0.8);
    color: #000;
    outline: none;
    font-size: 16px;
}

/* LABEL */
.input-container label {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(0,0,0,0.5);
    pointer-events: none;
    transition: all 0.2s ease;
    font-size: 16px;
    background: transparent;
    padding: 0 4px;
}

/* LABEL FLOATS WHEN FOCUSED OR INPUT HAS VALUE */
.input-container input:focus + label,
.input-container input:not(:placeholder-shown) + label,
.input-container input.not-empty + label {
    top: -2px;
    left: 16px;
    font-size: 12px;
    color: #444;
    background: #f4fef2;
    padding: 0 6px;
    border-radius: 6px;
}

/* SELECT FIELD */
.input-container select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%;
    padding: 18px 52px 18px 22px;
    border-radius: 50px;
    border: 1px solid rgba(0,0,0,0.2);
    background: rgba(255,255,255,0.9);
    font-size: 16px;
    outline: none;
    cursor: pointer;
}

/* FLOATING LABEL FOR SELECT */
.input-container select:focus + label,
.input-container select:not([value=""]) + label {
    top: -6px;
    left: 16px;
    font-size: 12px;
    color: #444;
    background: #f4fef2;
    padding: 0 6px;
    border-radius: 6px;
}

/* SELECT ARROW */
.input-container:has(select)::after {
    content: "";
    position: absolute;
    right: 18px;
    top: 50%;
    width: 10px;
    height: 10px;
    border-right: 2px solid #2e7d32;
    border-bottom: 2px solid #2e7d32;
    transform: translateY(-50%) rotate(45deg);
    pointer-events: none;
}

/* ================= LOGIN BUTTON ================= */
button {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 50px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    color: #fff;
    background: linear-gradient(-45deg, #2e7d32, #43a047, #66bb6a, #81c784);
    background-size: 400% 400%;
    animation: gradientMove 5s ease infinite;
    transition: all 0.3s ease;
}

button:hover {
    filter: brightness(1.1);
}

@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* ================= REMEMBER / FORGOT ================= */
.remember-forgot {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    font-size: 14px;
    color: #000;
}

.remember-forgot label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    color: #000;
}

/* Checkbox */
.remember-forgot input[type="checkbox"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #a5a5a5;
    border-radius: 50%;
    position: relative;
    cursor: pointer;
    outline: none;
    transition: all 0.2s;
    background: #fff;
}

.remember-forgot input[type="checkbox"]:checked {
    background-color: #2e7d32;
    border-color: #2e7d32;
}

.remember-forgot input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 6px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: translate(-50%, -50%) rotate(45deg);
}

/* Links */
.remember-forgot a,
.sign-up a {
    color: #2e7d32;
    text-decoration: none;
}

.remember-forgot a:hover,
.sign-up a:hover {
    text-decoration: underline;
}

/* SIGN UP LINK */
.sign-up {
    text-align: center;
    margin-top: 20px;
    font-size: 14px;
    color: #000;
}

/* ================= REGISTER FORM ================= */
#registerForm {
    display: none;
    position: absolute;
    top: 0;
    left: 5rem;
    right: 1rem;
    bottom: 0;
    padding: 3rem 4rem;
    background: #f4fef2;
    border-radius: 25px;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    overflow-y: auto;
    box-sizing: border-box;
    z-index: 5;
}

/* Transparent Scrollbar */
#registerForm::-webkit-scrollbar {
    width: 6px;
    background: transparent;
}
#registerForm::-webkit-scrollbar-thumb {
    background: transparent;
}

/* REGISTER GRID */
.register-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    width: 100%;
}

.register-grid .full {
    grid-column: span 2;
}

.register-grid .input-container input,
.register-grid .input-container select,
.file-upload {
    width: 100%;
    box-sizing: border-box;
}

/* FILE UPLOAD */
.file-upload.full {
    grid-column: span 2;
}

input[type="file"] {
    padding: 14px;
    border-radius: 18px;
    border: 1px dashed rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.7);
    font-size: 14px;
    cursor: pointer;
}

.file-upload input {
    display: none;
}

.file-upload label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 22px;
    border-radius: 22px;
    border: 1px dashed rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.8);
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-upload label span {
    font-size: 15px;
    color: #333;
}

.file-upload label small {
    font-size: 12px;
    color: #777;
}

.file-upload label:hover {
    border-color: #2e7d32;
    background: rgba(46,125,50,0.08);
}

/* REGISTER HEADER */
.register-header {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin-bottom: 10px;
}

.register-header h2 {
    margin: 0;
    text-align: center;
}

.register-header .back-btn {
    position: absolute;
    left: 0;
}

/* SECTION LABEL */
.form-section {
    grid-column: span 2;
    font-size: 13px;
    font-weight: 600;
    color: #2e7d32;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 22px;
    margin-bottom: 12px;
}
.input-container .error-msg {
    position: absolute;
    bottom: -16px; /* space below input */
    left: 18px;
    font-size: 12px;
    color: red;
}

/* PASSWORD FIELD */
.password-field {
    position: relative;
}

/* SVG eye button */
.toggle-password {
    position: absolute;
    right: 18px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
}


.toggle-password img {
    filter: grayscale(100%) opacity(0.6);
}


/* ================= ROUND SVG BACK BUTTON ================= */
.back-btn {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: #ffffff;
    border: 1px solid rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    margin-bottom: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.back-icon {
    width: 26px;
    height: 26px;
    stroke: #2e7d32;
    stroke-width: 6;
    fill: none;
}

.back-btn:hover {
    background: #e3e3e3;
}

.back-btn:hover .back-icon {
    stroke: #0b0303;
}

/* ================= MEDIA QUERIES ================= */

/* Medium Screens / Tablets (≤900px) */
@media (max-width: 900px) {

    /* REGISTER FORM */
    #registerForm {
        width: 100%;
        left: 0;
        padding: 0.5rem 0.5rem;
        position: relative;
        border-radius: 15px;
        margin: 0 auto;
        box-sizing: border-box;
    }

    .form-container {
        width: 100%;
        max-width: 100%;
        padding: 0.5rem 0.5rem;
        margin: 0;
    }

    .register-grid {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .register-grid .full {
        grid-column: span 2;
    }

    .register-grid .input-container input,
    .register-grid .input-container select {
        width: 100%;
        padding: 10px 12px;
        font-size: 14px;
    }

    .input-container label {
        font-size: 13px;
    }

    button {
        width: 100%;
        padding: 12px;
        font-size: 14px;
    }

    .sign-in-desc {
        font-size: 12px;
        margin-bottom: 10px;
    }

    .remember-forgot, .sign-up {
        font-size: 12px;
    }

    .register-header h2 {
        font-size: 18px;
    }

    .register-header .back-btn {
        width: 36px;
        height: 36px;
    }

    .back-icon {
        width: 20px;
        height: 20px;
    }

    /* LEFT SIDE adjustments */
    body { overflow-y: auto; }
    .container { flex-direction: column; height: auto; }

    .left-side {
        position: fixed;
        top: -10px;
        left: 0;
        width: 100%;
        height: 50vh;
        z-index: 1;
    }

    .school-header {
        transform: translate(-10px, -10px);
        max-width: 90%;
    }

    .school-header img {
        width: 150px;
        margin-bottom: 0.8rem;
    }

    .school-header h1 {
        font-size: 18px;
        margin-bottom: 8px;
    }

    .school-header p {
        font-size: 12px;
        line-height: 1.4;
    }

    .right-side {
        position: relative;
        margin-left: 0;
        margin-top: 40vh;
        width: 100%;
        clip-path: none;
        box-shadow: none;
        overflow-y: auto;
        -ms-overflow-style: none;
        scrollbar-width: none;
        border-top-left-radius: 25px;
        border-top-right-radius: 25px;
        background: #f4fef2;
    }

    .right-side::-webkit-scrollbar { display: none; }

    .form-container {
        width: 90%;
        max-width: 420px;
        margin: 0 auto 2rem auto;
    }
}

/* Small Phones (≤480px) */
@media (max-width: 480px) {

    .left-side {
        height: 50vh;
        justify-content: center;
        align-items: center;
    }

    .school-header {
        transform: translate(0, 0);
        text-align: center;
        margin-top: -170px;
    }

    .school-header img {
        width: 100px;
        margin-bottom: 0.5rem;
    }

    .school-header h1 {
        font-size: 16px;
        margin-bottom: 6px;
    }

    .school-header p {
        font-size: 10px;
        line-height: 1.3;
    }

    .right-side {
        margin-top: 30vh;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        padding: 2rem 1rem;
        clip-path: none;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        background: #f4fef2;
    }

    .form-container {
        width: 90%;
        max-width: 350px;
        padding: 2rem 1rem;
        margin-left: 20px;
        text-align: center;
    }

    .site-logo {
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
    }

    .site-logo img { width: 18px; height: 18px; }
    .site-logo span { font-size: 16px; }

    .input-container input {
        padding: 12px 14px;
        font-size: 14px;
    }

    .input-container label { font-size: 14px; }

    button {
        padding: 12px;
        font-size: 14px;
    }

    .sign-in-desc { font-size: 12px; margin-bottom: 16px; }

    .remember-forgot, .sign-up { font-size: 12px; }
}
</style>

</head>
<body>

<div class="container"> 

    <!-- ================= LEFT SIDE ================= -->
    <div class="left-side">
        <div class="school-header">
            <img src="images/school_logo.png" alt="School Logo">
            <h1>TAGBILARAN CITY COLLEGE</h1>
            <p>Character. Leadership. Service. Competence. Academic Excellence</p>
        </div>
    </div>

    <!-- ================= RIGHT SIDE ================= -->
    <div class="right-side">

        <!-- ======= LOGIN FORM ======= -->
        <div class="form-container" id="loginForm">

            <!-- Logo -->
            <div class="site-logo">
                <img src="images/logo1.png" alt="Attendify Logo">
                <span>attendify.</span>
            </div>

            <!-- Login Header -->
            <h2>Log in to your Account</h2>
            <p class="sign-in-desc">Welcome back! We’re glad to see you again.</p>

            <!-- Input Fields with floating labels -->
            <div class="input-container">
                <input type="email" id="loginEmail" placeholder=" " required>
                <label for="loginEmail">Email</label>
            </div>

            <div class="input-container password-field">
                <input type="password" id="loginPassword" placeholder=" " required>
                <label>Password</label>

                <span class="toggle-password" onclick="togglePassword('loginPassword', this)">
                    <!-- Eye Open -->
                    <img class="eye-open" src="feather/eye.svg" alt="Show Password" style="width:22px; height:22px;"/>
                    <!-- Eye Closed -->
                    <img class="eye-closed" src="feather/eye-off.svg" alt="Hide Password" style="width:22px; height:22px; display:none;"/>
                </span>
            </div>

            <!-- Remember -->
            <div class="remember-forgot">
                <label><input type="checkbox" id="rememberMe"> Remember Me</label>
            </div>


            <!-- Login Button -->
            <button id="loginBtn">Login</button>


            <!-- Sign Up Link -->
            <div class="sign-up">
                Don’t have an account? <a href="#" onclick="showRegister()">Sign Up</a>
            </div>
        </div>

        <!-- ======= REGISTER FORM ======= -->
        <div id="registerForm" style="display:none; background: #f4fef2;">

            <!-- Register Header -->
            <div class="register-header">
                <button class="back-btn" onclick="showLogin()" aria-label="Back">
                    <svg viewBox="0 0 24 24" class="back-icon">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <h2>Create Account</h2>
            </div>

            <p class="sign-in-desc">Please fill in the required information</p>

            <!-- Register Grid -->
            <div class="register-grid">

                <!-- ===== Personal Information ===== -->
                <div class="form-section">Personal Information</div>
                <div class="input-container"><input type="text" id="firstName" placeholder=" " required><label>First Name</label></div>
                <div class="input-container"><input type="text" id="middleName" placeholder=" "required><label>Middle Name</label></div>
                <div class="input-container"><input type="text" id="lastName" placeholder=" " required><label>Last Name</label></div>
                <div class="input-container"><input type="text" id="extension" placeholder=" "><label>Extension (Optional)</label></div>
                <div class="input-container full"><input type="date" id="birthday" placeholder=" " required><label>Birthday</label></div>
                <div class="input-container full"><input type="text" id="address" placeholder=" " required><label>Address</label></div>

                <!-- ===== Academic Information ===== -->
                <div class="form-section">Academic Information</div>
                <div class="input-container full"><input type="email" id="regEmail" placeholder=" " required><label>Email</label></div>
                <div class="input-container">
                    <input type="text"
                        id="studentID"
                        placeholder=" "
                        required
                        inputmode="numeric"
                        pattern="[0-9]+"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    <label>Student ID</label>
                </div>

                <div class="input-container">
                    <select id="course" required>
                        <option value="" disabled selected>Select Course</option>
                        <option>BSIT</option>
                        <option>BSCS</option>
                        <option>BSECE</option>
                    </select>
                    <label>Course</label>
                </div>
                <div class="input-container">
                    <select id="year" required>
                        <option value="" disabled selected>Select Year</option>
                        <option>1st Year</option>
                        <option>2nd Year</option>
                        <option>3rd Year</option>
                        <option>4th Year</option>
                    </select>
                    <label>Year</label>
                </div>
                <div class="input-container">
                    <select id="gender" required>
                        <option value="" disabled selected>Select Gender</option>
                        <option>Male</option>
                        <option>Female</option>
                    </select>
                    <label>Gender</label>
                </div>

                <!-- ===== Account Security ===== -->
                <div class="input-container password-field">
                    <input type="password" id="regPassword" placeholder=" " required>
                    <label>Password</label>

                    <span class="toggle-password" onclick="togglePassword('regPassword', this)">
                        <!-- Eye Open -->
                        <img class="eye-open" src="feather/eye.svg" alt="Show Password" style="width:22px; height:22px;"/>
                        <!-- Eye Closed -->
                        <img class="eye-closed" src="feather/eye-off.svg" alt="Hide Password" style="width:22px; height:22px; display:none;"/>
                    </span>
                </div>

                <div class="input-container password-field">
                    <input type="password" id="confirmPassword" placeholder=" " required>
                    <label>Confirm Password</label>

                    <span class="toggle-password" onclick="togglePassword('confirmPassword', this)">
                        <!-- Eye Open -->
                        <img class="eye-open" src="feather/eye.svg" alt="Show Password" style="width:22px; height:22px;"/>
                        <!-- Eye Closed -->
                        <img class="eye-closed" src="feather/eye-off.svg" alt="Hide Password" style="width:22px; height:22px; display:none;"/>
                    </span>
                </div>



            </div>
            <!-- Terms & Conditions Checkbox -->
            <div class="remember-forgot" style="margin-top:10px;">
                <label>
                    <input type="checkbox" id="termsCheckbox">
                    I agree to the <a href="#" onclick="openTermsFromCheckbox(event)">Terms & Conditions</a>
                </label>
            </div>

            <button id="createAccountBtn" disabled style="opacity:0.6; cursor:not-allowed;">
                Create Account
            </button>

            <!-- Sign In Link -->
            <div class="sign-up">
                Already have an account? <a href="#" onclick="showLogin()">Sign in</a>
            </div>

        </div> <!-- End Register Form -->

    </div> <!-- End Right Side -->

</div> <!-- End Container -->

<!-- Terms & Conditions Modal -->
<div id="termsModal" style="display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:10;">
    <div style="background:#fff; padding:2rem; border-radius:15px; max-width:500px; width:90%; max-height:80vh; overflow-y:auto; position:relative;">
        <h3>Terms & Conditions</h3>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
            Please read and agree to the terms before continuing.
        </p>
        <p>
            <!-- You can add your full T&C here -->
        </p>
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
            <button id="declineTerms" style="padding:8px 12px; border:none; border-radius:8px; cursor:pointer; background:#ccc;">Decline</button>
            <button id="acceptTerms" style="padding:8px 12px; border:none; border-radius:8px; cursor:pointer; background:#2e7d32; color:white;">I Agree</button>
        </div>
    </div>
</div>

<!-- ===== Supabase SDK ===== -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
/* ================= SUPABASE SETUP ================= */
const SUPABASE_URL = "https://snyzylwynzwzchivczms.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNueXp5bHd5bnp3emNoaXZjem1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NTM5NDQsImV4cCI6MjA4MTAyOTk0NH0.QBBdQUqS_wpo6CTl4mppziCCbiigq8Fqg9KjsVfcmMM";

const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ================= HELPERS ================= */
function showFieldError(id, message) {
    const input = document.getElementById(id);
    if (!input) return;
    const old = input.parentElement.querySelector(".error-msg");
    if (old) old.remove();
    const span = document.createElement("span");
    span.className = "error-msg";
    span.textContent = message;
    input.parentElement.appendChild(span);
}

function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function isStrongPassword(password) {
    return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?#&]).{8,}$/.test(password);
}

/* ================= PASSWORD TOGGLE ================= */
function togglePassword(inputId, icon) {
    const input = document.getElementById(inputId);
    const eyeOpen = icon.querySelector(".eye-open");
    const eyeClosed = icon.querySelector(".eye-closed");

    if (input.type === "password") {
        input.type = "text";
        eyeOpen.style.display = "none";
        eyeClosed.style.display = "block";
    } else {
        input.type = "password";
        eyeOpen.style.display = "block";
        eyeClosed.style.display = "none";
    }
}


/* ================= LOGIN ================= */
// --- Populate email & password on page load if saved ---
window.addEventListener("DOMContentLoaded", () => {
    const savedEmail = localStorage.getItem("rememberedEmail");
    const savedPassword = localStorage.getItem("rememberedPassword");

    if (savedEmail) document.getElementById("loginEmail").value = savedEmail;
    if (savedPassword) document.getElementById("loginPassword").value = savedPassword;

    if (savedEmail || savedPassword) document.getElementById("rememberMe").checked = true;
});

async function loginUser() {
    const email = loginEmail.value.trim();
    const password = loginPassword.value.trim();
    document.querySelectorAll(".error-msg").forEach(e => e.remove());

    if (!email) return showFieldError("loginEmail", "Email is required");
    if (!isValidEmail(email)) return showFieldError("loginEmail", "Invalid email");
    if (!password) return showFieldError("loginPassword", "Password is required");

    const { data, error } = await supabaseClient
        .from("Student")
        .select("*")
        .eq("email", email)
        .single();

    if (error || !data) return showFieldError("loginEmail", "Email not found");
    if (data.password !== password) return showFieldError("loginPassword", "Incorrect password");

    // --- Remember Me ---
    const remember = document.getElementById("rememberMe").checked;
    if (remember) {
        localStorage.setItem("rememberedEmail", email);
        localStorage.setItem("rememberedPassword", password);
    } else {
        localStorage.removeItem("rememberedEmail");
        localStorage.removeItem("rememberedPassword");
    }

    localStorage.setItem("adminUser", JSON.stringify(data));
    
    window.location.href = "home.html";
}




/* ================= TERMS & CONDITIONS ================= */
const termsCheckbox = document.getElementById("termsCheckbox");
const createBtn = document.getElementById("createAccountBtn");
const termsModal = document.getElementById("termsModal");
const acceptTerms = document.getElementById("acceptTerms");
const declineTerms = document.getElementById("declineTerms");

// Disable create account initially
createBtn.disabled = true;
createBtn.style.opacity = "0.6";
createBtn.style.cursor = "not-allowed";

// Open modal when checkbox clicked
termsCheckbox.addEventListener("click", (e) => {
    e.preventDefault();
    openTermsModal();
});

function openTermsModal() {
    termsCheckbox.checked = false;
    termsModal.style.display = "flex";
}

// Accept Terms
acceptTerms.onclick = () => {
    termsModal.style.display = "none";
    termsCheckbox.checked = true;
    createBtn.disabled = false;
    createBtn.style.opacity = "1";
    createBtn.style.cursor = "pointer";
};

// Decline Terms
declineTerms.onclick = () => {
    termsModal.style.display = "none";
    termsCheckbox.checked = false;
    createBtn.disabled = true;
    createBtn.style.opacity = "0.6";
    createBtn.style.cursor = "not-allowed";
};

/* ================= REGISTER ================= */
async function registerStudent() {
    document.querySelectorAll(".error-msg").forEach(e => e.remove());

    if (!termsCheckbox.checked) {
        alert("You must agree to the Terms & Conditions.");
        return;
    }

    let valid = true;
    registerForm.querySelectorAll("input[required], select[required]").forEach(el => {
        if (!el.value.trim()) {
            showFieldError(el.id, "Required");
            valid = false;
        }
    });
    if (!valid) return;

    registerStudentFinal();
}

async function registerStudentFinal() {
    // --- Get values safely from the form ---
    const firstNameVal = document.getElementById("firstName")?.value.trim() || "";
    const middleNameVal = document.getElementById("middleName")?.value.trim() || "";
    const lastNameVal = document.getElementById("lastName")?.value.trim() || "";
    const extensionVal = document.getElementById("extension")?.value.trim() || null;
    const emailVal = document.getElementById("regEmail")?.value.trim() || "";
    const studentIDVal = document.getElementById("studentID")?.value.trim() || "";
    const courseVal = document.getElementById("course")?.value || "";
    
    // --- Year as numeric based on dropdown index ---
    const yearDropdown = document.getElementById("year");
    const yearVal = (yearDropdown.selectedIndex >= 0) ? yearDropdown.selectedIndex : null;

    const genderVal = document.getElementById("gender")?.value || "";
    const birthdayVal = document.getElementById("birthday")?.value || null;
    const addressVal = document.getElementById("address")?.value.trim() || null;
    const pictureVal = document.getElementById("picture")?.value || "images/your-pfp.jpg";
    const passwordVal = document.getElementById("regPassword")?.value || "";
    const confirmPasswordVal = document.getElementById("confirmPassword")?.value || "";

    // --- Validation ---
    if (!isValidEmail(emailVal)) return showFieldError("regEmail", "Invalid email");
    if (!/^[0-9]+$/.test(studentIDVal)) return showFieldError("studentID", "Numbers only");
    if (!isStrongPassword(passwordVal)) return showFieldError("regPassword", "8+ chars, upper, lower, number & symbol");
    if (passwordVal !== confirmPasswordVal) return showFieldError("confirmPassword", "Passwords do not match");

    // --- Check if email already exists ---
    const { data: exists } = await supabaseClient
        .from("Student")
        .select("studentid") // check by primary key or email
        .eq("email", emailVal)
        .single();
    if (exists) return showFieldError("regEmail", "Email already registered");

    // --- Insert new student ---
    const { data: newStudent, error: insertError } = await supabaseClient
        .from("Student")
        .insert([{
            firstname: firstNameVal,
            middlename: middleNameVal,
            lastname: lastNameVal,
            extension: extensionVal,
            email: emailVal,
            studentid: studentIDVal, // official student ID
            course: courseVal,
            year: yearVal,
            gender: genderVal,
            birthday: birthdayVal,
            address: addressVal,
            picture: pictureVal,
            organizer: false,
            password: passwordVal
        }])
        .select() // returns the inserted record
        .single();

    if (insertError) return alert(insertError.message);

    // --- Generate QR code using studentid (not id) ---
    try {
        const qrContent = `student:${studentIDVal}`; // <-- FIXED here
        const qrDataURL = await QRCode.toDataURL(qrContent);

        // Update student record with QR code
        const { error: qrError } = await supabaseClient
            .from("Student")
            .update({ qr: qrDataURL })
            .eq("studentid", studentIDVal); // update by studentid

        if (qrError) throw qrError;

        console.log("QR code generated and stored successfully!");
    } catch (err) {
        console.error("Error generating QR code:", err.message);
    }

    alert("Registration successful!");
    window.location.href = "index.html"; // redirect after registration
}

/* ================= FORM TOGGLE ================= */
function showRegister() {
    loginForm.style.display = "none";
    registerForm.style.display = "block";
}

function showLogin() {
    registerForm.style.display = "none";
    loginForm.style.display = "block";
}

/* ================= FLOATING LABEL ================= */
document.querySelectorAll('.input-container input, .input-container select').forEach(el => {
    el.addEventListener('input', () => {
        el.classList.toggle('not-empty', el.value.trim() !== '');
        el.parentElement.querySelector(".error-msg")?.remove();
    });
});

/* ================= EVENTS ================= */
loginBtn.addEventListener("click", loginUser);
createAccountBtn.addEventListener("click", registerStudent);
</script>


</body>

</html>
